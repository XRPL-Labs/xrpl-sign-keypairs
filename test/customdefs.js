'use strict';
const sign = require("..");
// const sortSigner = require("../lib/sort_signer");
const keypairs = require("ripple-keypairs");
const {XrplDefinitions} = require('ripple-binary-codec');
const assert = require('assert');

const testkeys = [
    "sp8nE7459mWYQRQtXHvq17xm8tRyN",
    "snCdBeMquLRfoFLsJpSEM9atptPFX",
    "sn9UvPSEv5W5c95KHum5CcQ8S9WfG",
    "shqHRHUWFPkGPdUfKVTkFsfQsUe8Q",
    "sscUnb67uX5MCGBCCJTZaE4BamcVe"
]

const accounts = testkeys.map((v) => {
    const kp = keypairs.deriveKeypair(v)
    const address = keypairs.deriveAddress(kp.publicKey)
    return {
        keypair : kp,
        address : address,
    }
})

describe('Custom definitions', function () {
    it('Custom definitions', function(){
        const definitions = new XrplDefinitions(require('./customDefinitions.json'))
        const tx = {}
        tx.TransactionType = 'SetHook'
        tx.Account = accounts[0].address
        tx.Destination = accounts[1].address
        tx.Hooks = [ { Hook: {
            CreateCode: "0061736D01000000011C0460057F7F7F7F7F017E60037F7F7E017E60027F7F017F60017F017E02230303656E76057472616365000003656E7606616363657074000103656E76025F670002030201030503010002062B077F0141B088040B7F004180080B7F0041A6080B7F004180080B7F0041B088040B7F0041000B7F0041010B07080104686F6F6B00030AC4800001C0800001017F230041106B220124002001200036020C41920841134180084112410010001A410022002000420010011A41012200200010021A200141106A240042000B0B2C01004180080B254163636570742E633A2043616C6C65642E00224163636570742E633A2043616C6C65642E22",
            Flags: 1,
            HookApiVersion: 0,
            HookNamespace: "F".repeat(64),
            HookOn: "F".repeat(58) + "BFFFFE",
        } } ]

        const txJSON = JSON.stringify(tx)
        const r = sign(txJSON, accounts[0].keypair, { definitions })

        assert( r.id === '8F48C2DB243FB054E3DC7552368D0DEBFAA0DDB0BB77AEA6324095881F4B4079');
        assert( r.signedTransaction === '120016732103A80FB3AAC8F20ABAFB1758BBF8AF2B06AAB3182A1B4584F839BD4640587101FF7446304402201A03AEE28EA5BF9CE801D4C89B6B1F59512DE0793DBAA4F197D3D6CBA791F498022045CBA447F46B2AC9D26EF42EE316C6608C6F73740D667FCCC4338BAF86698A918114A71156E659A1078C600E195386C159610AA280D88314DE1F8C18D86B47BE860B4868905CA4E45450A45AFBEE1014000022000000015014FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFBFFFFE5020FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7BC1400061736D01000000011C0460057F7F7F7F7F017E60037F7F7E017E60027F7F017F60017F017E02230303656E76057472616365000003656E7606616363657074000103656E76025F670002030201030503010002062B077F0141B088040B7F004180080B7F0041A6080B7F004180080B7F0041B088040B7F0041000B7F0041010B07080104686F6F6B00030AC4800001C0800001017F230041106B220124002001200036020C41920841134180084112410010001A410022002000420010011A41012200200010021A200141106A240042000B0B2C01004180080B254163636570742E633A2043616C6C65642E00224163636570742E633A2043616C6C65642E22E1F1');
    })
})
